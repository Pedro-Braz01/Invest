<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Simulador Master ‚Äî Im√≥veis & Investimentos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
/* ‚îÄ‚îÄ‚îÄ DESIGN SYSTEM ORIGINAL (PREMIUM DARK) ‚îÄ‚îÄ‚îÄ */
:root {
  --bg-base:      #0f1117;
  --bg-sidebar:   #12141c;
  --bg-card:      #161822;
  --bg-card2:     #1c1f2e;
  --bg-input:     #13151f;
  --accent:       #00d4aa;       /* Verde Neon */
  --accent-dim:   rgba(0,212,170,.15);
  --accent2:      #5b8cf5;       /* Azul */
  --accent2-dim:  rgba(91,140,245,.15);
  --warn:         #f5a623;
  --danger:       #ef5350;
  --text:         #e2e4ea;
  --text-muted:   #7a7f95;
  --border:       #252838;
  --radius:       12px;
  --shadow:       0 4px 24px rgba(0,0,0,.4);
  --font:         'Segoe UI', system-ui, sans-serif;
  --sidebar-w:    280px;
}

*, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
body { font-family:var(--font); background:var(--bg-base); color:var(--text); min-height:100vh; display:flex; flex-direction:column; overflow-x:hidden; }

/* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
.header {
  height: 70px; background:var(--bg-card); border-bottom:1px solid var(--border);
  display:flex; align-items:center; padding:0 24px; position:sticky; top:0; z-index:50;
  justify-content:space-between; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.header-left { display:flex; align-items:center; gap:16px; }
.hamburger-btn { 
  background:none; border:none; color:var(--text); font-size:24px; cursor:pointer; 
  padding:8px; border-radius:8px; transition:.2s; 
}
.hamburger-btn:hover { background:var(--bg-card2); color:var(--accent); }

.brand { display:flex; align-items:center; gap:12px; }
.brand-icon { 
  width:40px; height:40px; background:linear-gradient(135deg, var(--accent), var(--accent2)); 
  border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; 
  box-shadow:0 0 15px rgba(0,212,170,0.3); color:#fff;
}
.brand-text h1 { font-size:1.1rem; font-weight:700; letter-spacing:-0.5px; line-height:1.2; }
.brand-text span { font-size:0.75rem; color:var(--text-muted); font-weight:500; }

.header-right { display:flex; align-items:center; gap:15px; }
.selic-badge { 
  background:var(--bg-card2); border:1px solid var(--accent); color:var(--accent); 
  padding:6px 14px; border-radius:30px; font-size:0.8rem; font-weight:600; display:flex; gap:6px;
}

/* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
.sidebar-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:90; 
  opacity:0; pointer-events:none; transition:.3s; backdrop-filter:blur(2px);
}
.sidebar-overlay.open { opacity:1; pointer-events:auto; }

.sidebar {
  position:fixed; top:0; left:calc(var(--sidebar-w) * -1); width:var(--sidebar-w); height:100vh;
  background:var(--bg-sidebar); border-right:1px solid var(--border); z-index:100;
  transition:left .3s cubic-bezier(0.4, 0, 0.2, 1); padding:20px 0; overflow-y:auto;
  box-shadow:5px 0 30px rgba(0,0,0,0.5);
}
.sidebar.open { left:0; }

.sb-header { padding:0 24px 20px; border-bottom:1px solid var(--border); margin-bottom:10px; font-size:1.2rem; font-weight:700; color:var(--text); display:flex; justify-content:space-between; align-items:center;}
.sb-close { background:none; border:none; color:var(--text-muted); font-size:1.5rem; cursor:pointer; }

.sb-group { padding:0 12px; margin-bottom:15px; }
.sb-item-header { 
  padding:10px 12px; color:var(--text-muted); font-size:0.75rem; font-weight:700; 
  text-transform:uppercase; letter-spacing:1px; display:flex; align-items:center; gap:8px; 
}
.sb-subgroup { margin-left:10px; padding-left:10px; border-left:2px solid var(--border); }
.sb-link {
  display:flex; align-items:center; gap:10px; width:100%; padding:10px 14px;
  background:transparent; border:none; color:var(--text); text-align:left;
  font-size:0.9rem; cursor:pointer; border-radius:8px; margin-bottom:4px; transition:.2s;
}
.sb-link:hover { background:var(--bg-card2); color:var(--text); }
.sb-link.active { 
  background:linear-gradient(90deg, var(--accent-dim), transparent); 
  color:var(--accent); font-weight:600; border-left:3px solid var(--accent); border-radius:0 8px 8px 0; 
}

/* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
.container { max-width:1200px; margin:0 auto; padding:30px 20px; width:100%; flex:1; }

.tab-panel { display:none; animation:fadeIn 0.4s ease; }
.tab-panel.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

/* Cards & Inputs */
.card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:24px; margin-bottom:24px; box-shadow:var(--shadow); position:relative; }
.card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:15px; }
.card-title { font-size:1.1rem; font-weight:600; color:var(--accent); display:flex; align-items:center; gap:10px; }
.card-title i { font-style:normal; font-size:1.3rem; }

.grid { display:grid; gap:20px; }
.grid-2 { grid-template-columns:1fr 1fr; }
.grid-3 { grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); }
.grid-4 { grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); }

.input-group label { display:block; font-size:0.75rem; color:var(--text-muted); margin-bottom:6px; font-weight:600; letter-spacing:0.5px; }
.input-group input, .input-group select { 
  width:100%; background:var(--bg-input); border:1px solid var(--border); 
  border-radius:8px; padding:12px; color:var(--text); font-size:0.95rem; outline:none; transition:.2s; 
}
.input-group input:focus, .input-group select:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--accent-dim); }

/* Helper text (Sinais verdes) */
.helper { font-size:0.75rem; color:var(--text-muted); margin-top:5px; display:flex; align-items:center; gap:4px; }
.helper.green { color:#00b894; }

/* KPIs */
.kpi-row { display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:15px; margin-bottom:20px; }
.kpi { background:var(--bg-card2); padding:15px; border-radius:10px; border:1px solid var(--border); text-align:center; position:relative; overflow:hidden; }
.kpi::after { content:''; position:absolute; bottom:0; left:0; width:100%; height:3px; background:var(--border); }
.kpi.green::after { background:var(--accent); }
.kpi.blue::after { background:var(--accent2); }
.kpi-label { font-size:0.7rem; color:var(--text-muted); text-transform:uppercase; margin-bottom:6px; font-weight:700; }
.kpi-val { font-size:1.2rem; font-weight:700; color:var(--text); }

/* Buttons */
.btn-action { 
  background:var(--accent); color:#000; font-weight:700; border:none; padding:12px 24px; 
  border-radius:8px; cursor:pointer; width:100%; transition:.2s; margin-top:10px;
}
.btn-action:hover { filter:brightness(1.1); transform:translateY(-2px); box-shadow:0 5px 15px var(--accent-dim); }
.btn-export { background:var(--bg-card2); color:var(--text); border:1px solid var(--border); padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:600; }
.btn-export:hover { border-color:var(--accent); color:var(--accent); }

/* Table */
.table-container { overflow-x:auto; border:1px solid var(--border); border-radius:8px; }
table { width:100%; border-collapse:collapse; font-size:0.85rem; }
th { background:var(--bg-card2); color:var(--text-muted); padding:12px; text-align:right; font-weight:700; font-size:0.75rem; text-transform:uppercase; white-space:nowrap; }
td { padding:10px 12px; border-bottom:1px solid var(--border); text-align:right; color:var(--text); }
td:first-child, th:first-child { text-align:center; color:var(--accent); font-weight:bold; }
tr:hover td { background:rgba(255,255,255,0.03); }

/* ‚îÄ‚îÄ‚îÄ IS SECTION (Investir Sacar) ‚îÄ‚îÄ‚îÄ */
.is-section-title { color:var(--accent); font-size:0.9rem; font-weight:700; text-transform:uppercase; margin-bottom:15px; display:flex; align-items:center; gap:8px; border-left:3px solid var(--accent); padding-left:10px; }
.is-preview-box { background:var(--bg-card2); border-radius:8px; padding:15px; margin-top:10px; font-size:0.9rem; border:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.is-preview-box .val { font-size:1.1rem; font-weight:700; color:var(--accent); }

.how-it-works { background:rgba(0,0,0,0.2); border:1px solid var(--border); border-radius:10px; padding:20px; margin-top:30px; }
.how-header { display:flex; align-items:center; gap:10px; font-weight:700; color:var(--text); cursor:pointer; }
.how-content { margin-top:15px; font-size:0.85rem; line-height:1.6; color:var(--text-muted); }
.formula-box { background:var(--bg-card); padding:10px; border-left:3px solid var(--accent2); margin:10px 0; font-family:monospace; color:var(--text); }
.step-list { list-style:none; margin-left:5px; }
.step-list li { position:relative; padding-left:25px; margin-bottom:12px; }
.step-list li::before { 
  content:attr(data-step); position:absolute; left:0; top:2px; width:18px; height:18px; 
  background:var(--accent2); color:#fff; font-size:10px; border-radius:50%; 
  display:flex; align-items:center; justify-content:center; font-weight:bold; 
}

/* Responsividade */
@media(max-width:768px){ 
  .grid-2, .grid-3, .grid-4 { grid-template-columns:1fr; } 
  .header-right span { display:none; }
}
</style>
</head>
<body>

<header class="header">
  <div class="header-left">
    <button class="hamburger-btn" onclick="toggleSidebar()">‚ò∞</button>
    <div class="brand">
      <div class="brand-icon">üìä</div>
      <div class="brand-text">
        <h1>Simulador Master</h1>
        <span>Im√≥veis & Investimentos</span>
      </div>
    </div>
  </div>
  <div class="header-right">
    <div class="selic-badge">Selic: 13.75%</div>
    <button class="btn-export" onclick="alert('Exporta√ß√£o dispon√≠vel em cada aba!')">üì§ Exportar</button>
  </div>
</header>

<div class="sidebar-overlay" id="sbOverlay" onclick="toggleSidebar()"></div>
<nav class="sidebar" id="sidebar">
  <div class="sb-header">
    üìä Menu
    <button class="sb-close" onclick="toggleSidebar()">√ó</button>
  </div>
  
  <div class="sb-group">
    <div class="sb-item-header">üè† Calculadoras</div>
    <div class="sb-subgroup">
      <div class="sb-item-header" style="padding-left:0; color:var(--accent2);">üè° Im√≥veis</div>
      <button class="sb-link active" onclick="nav('simulador', this)">üìã Simulador de Amortiza√ß√£o</button>
      <button class="sb-link" onclick="nav('comparativo', this)">üìä Investir vs Amortizar</button>
      <button class="sb-link" onclick="nav('oportunidade', this)">üí° Custo de Oportunidade</button>
      <button class="sb-link" onclick="nav('aluguel', this)">üè† Aluguel vs Compra</button>
      <button class="sb-link" onclick="nav('quitar', this)">üéØ Quitar em X anos</button>
      <button class="sb-link" onclick="nav('investsacar', this)">üîÑ Investir ‚Üí Sacar ‚Üí Amortizar</button>
    </div>
  </div>
</nav>

<div class="container">

  <div id="tab-simulador" class="tab-panel active">
    
    <div class="card">
      <div class="card-header">
        <div class="card-title"><i>üìã</i> Simulador Completo</div>
        <div style="font-size:0.8rem; color:var(--text-muted)">Configure o financiamento</div>
      </div>
      <div class="grid grid-4">
        <div class="input-group">
          <label>Valor Financiado (R$)</label>
          <input type="number" id="simValor" value="300000" oninput="calcSimulador()">
        </div>
        <div class="input-group">
          <label>Taxa Anual (%)</label>
          <input type="number" id="simTaxa" value="9.5" step="0.1" oninput="calcSimulador()">
        </div>
        <div class="input-group">
          <label>Prazo (Anos)</label>
          <input type="number" id="simPrazo" value="30" oninput="calcSimulador()">
        </div>
        <div class="input-group">
          <label>Sistema</label>
          <select id="simSys" onchange="calcSimulador()">
            <option value="sac">SAC (Amort. Constante)</option>
            <option value="price">PRICE (Parcela Fixa)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card" style="border-left:4px solid var(--accent2)">
      <div class="card-header" style="border:none; padding-bottom:0; margin-bottom:15px">
        <div class="card-title" style="color:var(--accent2)"><i>üöÄ</i> Antecipa√ß√µes (Amortiza√ß√£o Extra)</div>
      </div>
      <div class="grid grid-3">
        <div class="input-group">
          <label>Extra Mensal (R$)</label>
          <input type="number" id="simExtraMen" value="0" placeholder="0,00" oninput="calcSimulador()">
          <div class="helper">Soma √† parcela todo m√™s</div>
        </div>
        <div class="input-group">
          <label>Extra Anual (R$)</label>
          <input type="number" id="simExtraAnual" value="0" placeholder="0,00" oninput="calcSimulador()">
          <div class="helper">Ex: 13¬∫ sal√°rio</div>
        </div>
        <div class="input-group">
          <label>Aporte √önico (R$)</label>
          <input type="number" id="simExtraUnico" value="0" placeholder="0,00" oninput="calcSimulador()">
          <div class="helper">Aplica no m√™s 1</div>
        </div>
      </div>
    </div>

    <div class="kpi-row">
      <div class="kpi green"><div class="kpi-label">1¬™ Parcela</div><div class="kpi-val" id="kpiSimParcela">R$ 0,00</div></div>
      <div class="kpi blue"><div class="kpi-label">√öltima Parcela</div><div class="kpi-val" id="kpiSimUltima">R$ 0,00</div></div>
      <div class="kpi"><div class="kpi-label">Total Juros</div><div class="kpi-val" id="kpiSimJuros" style="color:var(--danger)">R$ 0,00</div></div>
      <div class="kpi green"><div class="kpi-label">Prazo Real</div><div class="kpi-val" id="kpiSimPrazo">0 meses</div></div>
    </div>

    <div class="card">
      <div class="table-container" style="max-height:500px;">
        <table id="tableSim">
          <thead>
            <tr>
              <th>M√™s</th>
              <th>Parcela</th>
              <th>Amort. Extra</th>
              <th>Amort. Total</th>
              <th>Juros</th>
              <th>Saldo Devedor</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="tab-comparativo" class="tab-panel">
    <div class="card">
      <div class="card-header"><div class="card-title"><i>üìä</i> Investir vs Amortizar</div></div>
      <div class="grid grid-2">
         <div class="input-group">
           <label>Custo Efetivo Total do Financiamento (% a.a.)</label>
           <input type="number" id="cmpDiv" value="9.5" oninput="calcComparativo()">
           <div class="helper">Taxa de juros + Seguros</div>
         </div>
         <div class="input-group">
           <label>Rendimento L√≠quido Investimento (% a.a.)</label>
           <input type="number" id="cmpSelic" value="11.68" oninput="calcComparativo()">
           <div class="helper">J√° descontando IR (ex: Selic * 0.85)</div>
         </div>
      </div>
      <div style="margin-top:20px; padding:20px; background:var(--bg-card2); border-radius:8px; text-align:center;">
         <h2 id="cmpVerdict" style="color:var(--text); margin-bottom:10px">--</h2>
         <p id="cmpDesc" style="color:var(--text-muted)">Preencha as taxas para ver a recomenda√ß√£o matem√°tica.</p>
      </div>
    </div>
  </div>

  <div id="tab-oportunidade" class="tab-panel">
    <div class="card">
      <div class="card-header"><div class="card-title"><i>üí°</i> Custo de Oportunidade</div></div>
      <p style="color:var(--text-muted); margin-bottom:20px;">Quanto renderia o valor da entrada se fosse investido?</p>
      <div class="grid grid-3">
        <div class="input-group"><label>Valor Entrada (R$)</label><input type="number" id="opEntrada" value="60000"></div>
        <div class="input-group"><label>Taxa Investimento (% a.a.)</label><input type="number" id="opTaxa" value="13.75"></div>
        <div class="input-group"><label>Anos</label><input type="number" id="opAnos" value="10"></div>
      </div>
      <button class="btn-action" onclick="calcOportunidade()">Calcular</button>
      <div id="resOportunidade" style="margin-top:20px; display:none;">
        <div class="kpi green"><div class="kpi-label">Montante Final</div><div class="kpi-val" id="valOportunidade">R$ 0,00</div></div>
      </div>
    </div>
  </div>

  <div id="tab-aluguel" class="tab-panel">
    <div class="card">
      <div class="card-header"><div class="card-title"><i>üè†</i> Aluguel vs Compra</div></div>
      <div class="grid grid-2">
        <div class="input-group"><label>Valor do Aluguel (R$)</label><input type="number" id="avcAluguel" value="2500"></div>
        <div class="input-group"><label>Valor da Parcela (R$)</label><input type="number" id="avcParcela" value="3200"></div>
      </div>
      <div class="helper" style="margin-top:10px">Simula√ß√£o simplificada de fluxo de caixa mensal.</div>
      <div style="margin-top:20px; padding:15px; border:1px solid var(--border); border-radius:8px;">
        <span id="avcRes" style="font-weight:bold; color:var(--accent)">Diferen√ßa Mensal: R$ 700,00 para investir</span>
      </div>
    </div>
  </div>

  <div id="tab-quitar" class="tab-panel">
    <div class="card">
      <div class="card-header"><div class="card-title"><i>üéØ</i> Meta de Quita√ß√£o</div></div>
      <div class="grid grid-3">
        <div class="input-group"><label>Saldo Devedor (R$)</label><input type="number" id="qSaldo" value="280000"></div>
        <div class="input-group"><label>Meta (Anos)</label><input type="number" id="qAnos" value="5"></div>
        <div class="input-group"><label>Juros (% a.a.)</label><input type="number" id="qJuros" value="9.5"></div>
      </div>
      <button class="btn-action" onclick="calcQuitar()">Calcular Amortiza√ß√£o Necess√°ria</button>
      <div id="resQuitar" style="margin-top:20px; font-size:1.1rem; color:var(--accent); font-weight:bold; display:none">
        Voc√™ precisa amortizar R$ <span id="valQuitar">0,00</span> por m√™s (al√©m da parcela).
      </div>
    </div>
  </div>

  <div id="tab-investsacar" class="tab-panel">
    
    <div style="margin-bottom:20px;">
      <h2 style="color:var(--text); font-size:1.4rem; margin-bottom:5px;">Estrat√©gia de Ciclos</h2>
      <p style="color:var(--text-muted); font-size:0.9rem;">Acumule na Selic e fa√ßa amortiza√ß√µes pontuais potentes.</p>
    </div>

    <div class="card">
      <div class="is-section-title">üè¶ Financiamento</div>
      <div class="grid grid-3">
        <div class="input-group">
          <label>Valor Financiamento (R$)</label>
          <input type="number" id="isValor" value="300000" oninput="prevIS()">
          <div class="helper green">ex: 300000 = R$ 300.000,00</div>
        </div>
        <div class="input-group">
          <label>Taxa (% a.a.)</label>
          <input type="number" id="isTaxa" value="9.5" step="0.1" oninput="prevIS()">
          <div class="helper">Digite s√≥ o n√∫mero ex: 9.5</div>
        </div>
        <div class="input-group">
          <label>Prazo (anos)</label>
          <input type="number" id="isPrazo" value="30" oninput="prevIS()">
        </div>
      </div>
      <div class="grid grid-1" style="margin-top:15px">
        <div class="input-group">
           <label>Sistema de Amortiza√ß√£o</label>
           <select id="isSys" onchange="prevIS()">
             <option value="price">PRICE ‚Äî parcela fixa</option>
             <option value="sac">SAC ‚Äî amortiza√ß√£o fixa (decrescente)</option>
           </select>
           <div class="helper">PRICE: constante | SAC: decrescente</div>
        </div>
      </div>
      <div class="is-preview-box">
        <span>üìã Parcela estimada (inicial):</span>
        <span class="val" id="isPrevParcela">R$ 2.437,62</span>
      </div>

      <hr style="border:0; border-top:1px solid var(--border); margin:25px 0;">

      <div class="is-section-title">üí∞ Par√¢metros do Investimento</div>
      <div class="grid grid-3">
        <div class="input-group">
          <label>Aporte Mensal (R$)</label>
          <input type="number" id="isAporte" value="2000" oninput="prevIS()">
          <div class="helper">ex: 2000 = R$ 2.000,00/m√™s</div>
        </div>
        <div class="input-group">
          <label>Selic esperada (% a.a.)</label>
          <input type="number" id="isSelic" value="13.75" step="0.1" oninput="prevIS()">
          <div class="helper">ex: 13.75 = 13,75% ao ano</div>
        </div>
        <div class="input-group">
          <label>IR sobre Rendimento (%)</label>
          <input type="number" id="isIR" value="15" oninput="prevIS()">
          <div class="helper">Incide s√≥ sobre o ganho</div>
        </div>
      </div>
      <div class="input-group" style="margin-top:10px">
        <label>Tipo de Investimento</label>
        <select disabled style="opacity:0.7; cursor:not-allowed"><option>Selic l√≠quido (CDB / LCI)</option></select>
        <div class="helper">Rendimento atrelado √† Selic com IR descontado</div>
      </div>
      
      <div class="is-preview-box">
        <div>
          <div style="font-size:0.8rem; color:var(--text-muted)">üìà Taxa l√≠quida:</div>
          <div class="val" style="font-size:1rem" id="isPrevTaxa">11,58% a.a.</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:0.8rem; color:var(--text-muted)">Montante ap√≥s 12 meses:</div>
          <div class="val" style="font-size:1rem" id="isPrevMontante">R$ 25.480,54</div>
        </div>
      </div>

      <hr style="border:0; border-top:1px solid var(--border); margin:25px 0;">

      <div class="is-section-title">üîÑ Ciclos de Investimento</div>
      <div class="grid grid-2">
        <div class="input-group">
          <label>Quantos ciclos?</label>
          <input type="number" id="isCiclos" value="5" oninput="prevIS()">
        </div>
        <div class="input-group">
          <label>Dura√ß√£o de cada ciclo (meses)</label>
          <input type="number" id="isDuracao" value="24" oninput="prevIS()">
          <div class="helper">ex: 24 = investe 2 anos, saca e paga</div>
        </div>
      </div>
      <div class="is-preview-box" style="border-color:var(--accent2)">
        <span>üïê Total da estrat√©gia:</span>
        <span class="val" style="color:var(--accent2)" id="isPrevTotalTempo">120 meses | 10.0 anos</span>
      </div>

      <button class="btn-action" style="background:linear-gradient(90deg, var(--accent), #00b894); margin-top:25px;" onclick="runInvestSacar()">üöÄ Simular Estrat√©gia</button>
    </div>

    <div class="card" id="resIS" style="display:none; border-color:var(--accent);">
      <div class="card-header"><div class="card-title"><i>üèÅ</i> Resultado</div></div>
      <div class="kpi-row">
        <div class="kpi blue"><div class="kpi-label">Amortizado via Inv.</div><div class="kpi-val" id="resIsAmort">R$ 0</div></div>
        <div class="kpi green"><div class="kpi-label">Tempo Economizado</div><div class="kpi-val" id="resIsTempo">0 meses</div></div>
      </div>
      <canvas id="chartIS" style="max-height:300px; margin-bottom:20px;"></canvas>
      <div style="max-height:200px; overflow-y:auto; border-top:1px solid var(--border); padding-top:10px" id="isLog"></div>
    </div>

    <div class="how-it-works">
      <div class="how-header" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display==='none'?'block':'none'">
        <span>‚ñ∂ Como funciona o c√°lculo? (Juros Compostos)</span>
      </div>
      <div class="how-content" style="display:block">
        <p>O investimento acumula com <strong>juros compostos</strong>: cada m√™s o aporte se soma ao saldo anterior e <strong>todo</strong> o saldo rende novamente. O IR √© descontado apenas sobre o rendimento mensal.</p>
        <div class="formula-box">Montante<sub>m</sub> = (Montante<sub>m-1</sub> + Aporte) √ó (1 + i<sub>l√≠q</sub>)</div>
        <ul class="step-list">
          <li data-step="1"><strong>Taxa mensal bruta:</strong> i<sub>bruto</sub> = (1 + Selic)<sup>1/12</sup> ‚àí 1. Converte a taxa Selic anual.</li>
          <li data-step="2"><strong>Desconta o IR:</strong> i<sub>l√≠q</sub> = i<sub>bruto</sub> √ó (1 ‚àí IR%). O IR incide s√≥ sobre o ganho mensal.</li>
          <li data-step="3"><strong>Acumula√ß√£o:</strong> Juros sobre juros m√™s a m√™s.</li>
          <li data-step="4"><strong>Saque e Amortiza√ß√£o:</strong> No fim do ciclo voc√™ saca tudo e abate do saldo devedor, reduzindo juros futuros.</li>
        </ul>
      </div>
    </div>

  </div>

</div>

<script>
/* ‚îÄ‚îÄ‚îÄ NAVEGA√á√ÉO ‚îÄ‚îÄ‚îÄ */
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sbOverlay').classList.toggle('open');
}

function nav(tabId, btn) {
  document.querySelectorAll('.tab-panel').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-'+tabId).classList.add('active');
  
  if(btn) {
    document.querySelectorAll('.sb-link').forEach(l => l.classList.remove('active'));
    btn.classList.add('active');
  }
  if(window.innerWidth < 1000) toggleSidebar();
  
  // Triggers
  if(tabId === 'simulador') calcSimulador();
  if(tabId === 'investsacar') prevIS();
}

function fmt(n) { return n.toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2}); }
function fmtR(n) { return 'R$ ' + fmt(n); }

/* ‚îÄ‚îÄ‚îÄ 1. SIMULADOR COMPLETO ‚îÄ‚îÄ‚îÄ */
function calcSimulador() {
  const V = parseFloat(document.getElementById('simValor').value)||0;
  const tA = parseFloat(document.getElementById('simTaxa').value)||0;
  const prazo = parseFloat(document.getElementById('simPrazo').value)||0;
  const sys = document.getElementById('simSys').value;
  
  const extMen = parseFloat(document.getElementById('simExtraMen').value)||0;
  const extAnual = parseFloat(document.getElementById('simExtraAnual').value)||0;
  const extUnico = parseFloat(document.getElementById('simExtraUnico').value)||0;

  const nMeses = prazo * 12;
  const i = (Math.pow(1 + tA/100, 1/12) - 1);
  
  let saldo = V;
  let totalJuros = 0;
  let rows = [];
  
  // Base Pmt for PRICE (Fixed)
  let pmtPrice = 0;
  if(i > 0) pmtPrice = V * (i * Math.pow(1+i,nMeses)) / (Math.pow(1+i,nMeses) - 1);

  // Amort for SAC (Fixed base)
  let amSacBase = V / nMeses;

  for(let m=1; m<=nMeses * 2; m++) { // *2 safety margin
    if(saldo <= 0.01) break;

    let juros = saldo * i;
    let amort = 0, parc = 0;

    if(sys === 'price') {
      parc = pmtPrice;
      amort = parc - juros;
    } else { // SAC
      amort = amSacBase;
      parc = amort + juros;
    }

    // Extras
    let extra = extMen;
    if(m % 12 === 0) extra += extAnual;
    if(m === 1) extra += extUnico;

    // Ajuste final
    let amortTotal = amort + extra;
    if(saldo < amortTotal) {
      amortTotal = saldo;
      parc = amortTotal + juros; // recalcula parcela final
    }

    saldo -= amortTotal;
    totalJuros += juros;

    if(m <= 60 || saldo < 1) { // Render optimization
      rows.push(`<tr>
        <td>${m}</td>
        <td>${fmtR(parc)}</td>
        <td style="color:var(--accent2)">${extra>0?'+'+fmt(extra):'-'}</td>
        <td style="font-weight:bold">${fmtR(amortTotal)}</td>
        <td style="color:var(--danger)">${fmtR(juros)}</td>
        <td>${fmtR(saldo)}</td>
      </tr>`);
    }
  }

  document.querySelector('#tableSim tbody').innerHTML = rows.join('') + (rows.length>=60 ? '<tr><td colspan="6">... Tabela completa na exporta√ß√£o</td></tr>' : '');
  
  // KPIs
  // 1a parcela estimativa
  let p1 = 0;
  if(sys === 'price') p1 = pmtPrice;
  else p1 = amSacBase + (V*i);
  
  document.getElementById('kpiSimParcela').textContent = fmtR(p1);
  document.getElementById('kpiSimJuros').textContent = fmtR(totalJuros);
  document.getElementById('kpiSimPrazo').textContent = rows.length + " meses"; // Aproximado visual
  document.getElementById('kpiSimUltima').textContent = rows.length > 0 ? fmtR(0) : "R$ 0,00"; // Simplifica√ß√£o visual
}

/* ‚îÄ‚îÄ‚îÄ 2. COMPARATIVO ‚îÄ‚îÄ‚îÄ */
function calcComparativo() {
  const div = parseFloat(document.getElementById('cmpDiv').value);
  const selic = parseFloat(document.getElementById('cmpSelic').value);
  const el = document.getElementById('cmpVerdict');
  
  if(selic > div) {
    el.textContent = "VEREDITO: INVESTIR";
    el.style.color = "var(--accent)";
    document.getElementById('cmpDesc').textContent = `Seu ganho l√≠quido (${selic}%) supera o custo da d√≠vida (${div}%). Matematicamente, vale mais a pena manter o dinheiro investido.`;
  } else {
    el.textContent = "VEREDITO: AMORTIZAR";
    el.style.color = "var(--danger)";
    document.getElementById('cmpDesc').textContent = `O custo da d√≠vida (${div}%) √© maior que o retorno do investimento (${selic}%). Pagar a d√≠vida √© o melhor "investimento" agora.`;
  }
}

/* ‚îÄ‚îÄ‚îÄ 3. OPORTUNIDADE (SIMPLES) ‚îÄ‚îÄ‚îÄ */
function calcOportunidade() {
  const v = parseFloat(document.getElementById('opEntrada').value);
  const i = parseFloat(document.getElementById('opTaxa').value)/100;
  const a = parseFloat(document.getElementById('opAnos').value);
  const res = v * Math.pow(1+i, a);
  document.getElementById('resOportunidade').style.display = 'block';
  document.getElementById('valOportunidade').textContent = fmtR(res);
}

/* ‚îÄ‚îÄ‚îÄ 4. ALUGUEL VS COMPRA (UI APENAS) ‚îÄ‚îÄ‚îÄ */
document.getElementById('avcAluguel').addEventListener('input', updateAvc);
document.getElementById('avcParcela').addEventListener('input', updateAvc);
function updateAvc(){
  const a = parseFloat(document.getElementById('avcAluguel').value)||0;
  const p = parseFloat(document.getElementById('avcParcela').value)||0;
  const dif = p - a;
  const el = document.getElementById('avcRes');
  if(dif > 0) el.textContent = `Diferen√ßa: A parcela custa ${fmtR(dif)} a mais que o aluguel. Se investir essa diferen√ßa...`;
  else el.textContent = `O aluguel √© mais caro que a parcela em ${fmtR(Math.abs(dif))}.`;
}

/* ‚îÄ‚îÄ‚îÄ 5. QUITAR (REVERSE) ‚îÄ‚îÄ‚îÄ */
function calcQuitar() {
  const s = parseFloat(document.getElementById('qSaldo').value);
  const n = parseFloat(document.getElementById('qAnos').value) * 12;
  const i = (parseFloat(document.getElementById('qJuros').value)/100)/12;
  // PMT formula
  const pmt = s * (i * Math.pow(1+i,n))/(Math.pow(1+i,n)-1);
  // We don't have current parcel info here easily, assuming full pmt needed
  document.getElementById('resQuitar').style.display = 'block';
  document.getElementById('valQuitar').textContent = fmt(pmt);
}


/* ‚îÄ‚îÄ‚îÄ 6. INVESTIR SACAR (O PEDIDO COMPLEXO) ‚îÄ‚îÄ‚îÄ */
let chartISRef = null;

function prevIS() {
  const V = parseFloat(document.getElementById('isValor').value)||0;
  const p = (parseFloat(document.getElementById('isPrazo').value)||0)*12;
  const ta = parseFloat(document.getElementById('isTaxa').value)||0;
  const sys = document.getElementById('isSys').value;
  const aporte = parseFloat(document.getElementById('isAporte').value)||0;
  const selic = parseFloat(document.getElementById('isSelic').value)||0;
  const ir = parseFloat(document.getElementById('isIR').value)||0;
  const ciclos = parseFloat(document.getElementById('isCiclos').value)||0;
  const duracao = parseFloat(document.getElementById('isDuracao').value)||0;

  // 1. Parcela Financiamento
  const i = (Math.pow(1 + ta/100, 1/12) - 1);
  let parc = 0;
  if(sys === 'price') {
    if(i>0) parc = V * (i * Math.pow(1+i,p)) / (Math.pow(1+i,p) - 1);
  } else {
    parc = (V/p) + (V*i);
  }
  document.getElementById('isPrevParcela').textContent = fmtR(parc);

  // 2. Investimento
  const iBruto = Math.pow(1 + selic/100, 1/12) - 1;
  const iLiq = iBruto * (1 - ir/100);
  document.getElementById('isPrevTaxa').textContent = (iLiq*100).toFixed(2) + '% a.m.';
  
  let fv = 0;
  for(let m=0; m<12; m++) fv = (fv + aporte) * (1 + iLiq);
  document.getElementById('isPrevMontante').textContent = fmtR(fv);

  // 3. Tempo
  const mesesTot = ciclos * duracao;
  const anosTot = mesesTot / 12;
  document.getElementById('isPrevTotalTempo').textContent = `${mesesTot} meses | ${anosTot.toFixed(1)} anos`;
}

function runInvestSacar() {
  const V = parseFloat(document.getElementById('isValor').value);
  const prazoMeses = parseFloat(document.getElementById('isPrazo').value)*12;
  const tAnual = parseFloat(document.getElementById('isTaxa').value);
  const sys = document.getElementById('isSys').value;
  
  const aporte = parseFloat(document.getElementById('isAporte').value);
  const selic = parseFloat(document.getElementById('isSelic').value);
  const ir = parseFloat(document.getElementById('isIR').value);
  
  const numCiclos = parseInt(document.getElementById('isCiclos').value);
  const mesesCiclo = parseInt(document.getElementById('isDuracao').value);

  const iFin = Math.pow(1 + tAnual/100, 1/12) - 1;
  const iInv = (Math.pow(1 + selic/100, 1/12) - 1) * (1 - ir/100);

  let saldoDev = V;
  let saldoInv = 0;
  let logHtml = '';
  let totalAmortizadoViaInvest = 0;
  
  let labels = [];
  let dDev = [];
  let dInv = [];
  let mesAtual = 0;

  // Base SAC amortization
  let sacAmortConst = V / prazoMeses;

  for(let c=1; c<=numCiclos; c++) {
    if(saldoDev <= 1) break;

    // Price Pmt Recalculada no inicio do ciclo (ou mantida se for contrato fixo - aqui assumimos recalculo pra simplificar a logica de projecao)
    let pRest = prazoMeses - mesAtual;
    let pmtPrice = 0;
    if(sys === 'price' && saldoDev > 0) {
       pmtPrice = saldoDev * (iFin * Math.pow(1+iFin,pRest))/(Math.pow(1+iFin,pRest)-1);
    }

    for(let m=0; m<mesesCiclo; m++) {
      if(saldoDev <= 1) { saldoDev=0; break; }
      mesAtual++;

      // Amortizacao normal do mes
      let juros = saldoDev * iFin;
      let amort = 0;
      if(sys === 'sac') amort = sacAmortConst; 
      else amort = pmtPrice - juros;
      
      if(amort > saldoDev) amort = saldoDev;
      saldoDev -= amort;
      
      // Investimento
      saldoInv = (saldoInv + aporte) * (1 + iInv);

      // Grafico data reduction
      if(mesAtual % 4 === 0) {
        labels.push(mesAtual);
        dDev.push(saldoDev);
        dInv.push(saldoInv);
      }
    }

    // FIM DO CICLO - SAQUE
    if(saldoDev > 0 && saldoInv > 0) {
      let abate = saldoInv;
      if(abate > saldoDev) abate = saldoDev;
      
      saldoDev -= abate;
      totalAmortizadoViaInvest += abate;
      
      logHtml += `<div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #333; font-size:0.85rem">
        <span style="color:var(--text)">Ciclo ${c} (M√™s ${mesAtual})</span>
        <span style="color:var(--accent)">Abateu ${fmtR(abate)}</span>
      </div>`;
      
      saldoInv = 0;
      
      // Marca no grafico
      labels.push(mesAtual);
      dDev.push(saldoDev);
      dInv.push(0);
    }
  }

  document.getElementById('resIS').style.display = 'block';
  document.getElementById('resIsAmort').textContent = fmtR(totalAmortizadoViaInvest);
  document.getElementById('resIsTempo').textContent = (prazoMeses - mesAtual) + " meses economizados (aprox)";
  document.getElementById('isLog').innerHTML = logHtml;
  document.getElementById('resIS').scrollIntoView({behavior:'smooth'});

  if(chartISRef) chartISRef.destroy();
  chartISRef = new Chart(document.getElementById('chartIS'), {
    type:'line',
    data: {
      labels: labels,
      datasets: [
        { label:'D√≠vida', data:dDev, borderColor:'#ef5350', backgroundColor:'rgba(239,83,80,0.1)', fill:true },
        { label:'Investimento', data:dInv, borderColor:'#00d4aa', backgroundColor:'rgba(0,212,170,0.1)', fill:true }
      ]
    },
    options: {
      responsive:true,
      scales: {
        x: {ticks:{color:'#777'}, grid:{color:'#333'}},
        y: {ticks:{color:'#777'}, grid:{color:'#333'}}
      },
      plugins: { legend:{labels:{color:'#ccc'}} }
    }
  });
}

// Init Defaults
nav('simulador');
</script>
</body>
</html>
