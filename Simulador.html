<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Simulador Avan√ßado ‚Äî Amortiza√ß√£o & Investimentos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Estilos baseados no seu index original */
        :root {
            --bg-base: #0f1117; --bg-card: #161822; --accent: #00d4aa; --text: #e2e4ea;
            --border: #252838; --radius: 12px; --danger: #ef5350;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-base); color: var(--text); padding: 20px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .input-group label { display: block; font-size: 0.75rem; color: #7a7f95; margin-bottom: 5px; }
        input, select { width: 100%; background: #13151f; border: 1px solid var(--border); padding: 10px; color: #fff; border-radius: 8px; }
        .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 20px 0; }
        .kpi { background: #1c1f2e; padding: 15px; border-radius: 10px; text-align: center; }
        .kpi-value { font-size: 1.2rem; font-weight: bold; color: var(--accent); }
        .chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-box { background: var(--bg-card); padding: 20px; border-radius: var(--radius); border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8rem; }
        th { background: #1c1f2e; padding: 10px; text-align: left; }
        td { padding: 8px; border-bottom: 1px solid var(--border); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card">
        <h2>‚öôÔ∏è Par√¢metros do Financiamento</h2>
        <div class="grid">
            <div class="input-group">
                <label>Valor do Financiamento (R$)</label>
                <input type="number" id="valorFinanc" value="300000" oninput="calcular()">
            </div>
            <div class="input-group">
                <label>Taxa Anual (%)</label>
                <input type="number" id="taxaAnual" value="9.5" step="0.1" oninput="calcular()">
            </div>
            <div class="input-group">
                <label>Prazo (meses)</label>
                <input type="number" id="prazoMeses" value="360" oninput="calcular()">
            </div>
            <div class="input-group">
                <label>Sistema</label>
                <select id="sistema" onchange="calcular()">
                    <option value="sac">SAC</option>
                    <option value="price">PRICE</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>‚ûï Amortiza√ß√£o Extra</h2>
        <div class="grid">
            <div class="input-group">
                <label>Valor Mensal Extra (R$)</label>
                <input type="number" id="valorExtra" value="1000" oninput="calcular()">
            </div>
            <div class="input-group">
                <label>Efeito do Extra</label>
                <select id="efeito" onchange="calcular()">
                    <option value="prazo">Reduzir Prazo</option>
                    <option value="parcela">Reduzir Parcela</option>
                </select>
            </div>
        </div>
    </div>

    <div class="kpi-row">
        <div class="kpi"><div>Economia de Juros</div><div id="kpiEconomia" class="kpi-value">R$ 0,00</div></div>
        <div class="kpi"><div>Prazo Reduzido em</div><div id="kpiReducao" class="kpi-value">0 meses</div></div>
    </div>

    <div class="chart-row">
        <div class="chart-box"><canvas id="chartSaldo"></canvas></div>
        <div class="chart-box"><canvas id="chartJuros"></canvas></div>
    </div>

    <div class="card">
        <h2>üìÑ Tabela de Amortiza√ß√£o</h2>
        <div style="max-height: 400px; overflow-y: auto;">
            <table>
                <thead>
                    <tr>
                        <th>M√™s</th><th>Parcela</th><th>Juros</th><th>Amortiz.</th><th>Saldo</th>
                    </tr>
                </thead>
                <tbody id="amortBody"></tbody>
            </table>
        </div>
    </div>

<script>
let chartSaldo, chartJuros;

function calcular() {
    const saldoInicial = parseFloat(document.getElementById('valorFinanc').value);
    const taxaMensal = (Math.pow(1 + (parseFloat(document.getElementById('taxaAnual').value) / 100), 1/12) - 1);
    const mesesOriginal = parseInt(document.getElementById('prazoMeses').value);
    const extra = parseFloat(document.getElementById('valorExtra').value) || 0;
    const tipo = document.getElementById('sistema').value;
    const efeito = document.getElementById('efeito').value;

    let saldo = saldoInicial;
    let totalJuros = 0;
    let mesesReal = 0;
    let html = '';
    let labels = [];
    let dadosSaldo = [];

    // C√°lculo Simples de Amortiza√ß√£o com Extra
    for (let i = 1; i <= mesesOriginal && saldo > 0; i++) {
        let jurosM√™s = saldo * taxaMensal;
        let amortM√™s = 0;

        if (tipo === 'sac') {
            amortM√™s = (efeito === 'prazo') ? (saldoInicial / mesesOriginal) : (saldo / (mesesOriginal - i + 1));
        } else {
            let pmt = saldoInicial * (taxaMensal / (1 - Math.pow(1 + taxaMensal, -mesesOriginal)));
            amortM√™s = pmt - (saldoInicial * taxaMensal); // Simplificado para o exemplo
        }

        let totalAmort = amortM√™s + extra;
        if (totalAmort > saldo) totalAmort = saldo;
        
        saldo -= totalAmort;
        totalJuros += jurosM√™s;
        mesesReal = i;

        if (i % 12 === 0 || i === 1) {
            labels.push(`M√™s ${i}`);
            dadosSaldo.push(saldo);
        }

        html += `<tr><td>${i}</td><td>R$ ${(jurosM√™s + totalAmort).toFixed(2)}</td><td>R$ ${jurosM√™s.toFixed(2)}</td><td>R$ ${totalAmort.toFixed(2)}</td><td>R$ ${Math.max(0, saldo).toFixed(2)}</td></tr>`;
    }

    document.getElementById('amortBody').innerHTML = html;
    document.getElementById('kpiReducao').innerText = `${mesesOriginal - mesesReal} meses`;
    
    updateCharts(labels, dadosSaldo, totalJuros, saldoInicial);
}

function updateCharts(labels, dadosSaldo, totalJuros, capital) {
    if (chartSaldo) chartSaldo.destroy();
    if (chartJuros) chartJuros.destroy();

    chartSaldo = new Chart(document.getElementById('chartSaldo'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Saldo Devedor', data: dadosSaldo, borderColor: '#00d4aa', tension: 0.1 }] }
    });

    chartJuros = new Chart(document.getElementById('chartJuros'), {
        type: 'doughnut',
        data: {
            labels: ['Juros Totais', 'Capital'],
            datasets: [{ data: [totalJuros, capital], backgroundColor: ['#ef5350', '#5b8cf5'] }]
        }
    });
}

window.onload = calcular;
</script>
</body>
</html>
